<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building an Introductory/Trivial application &mdash; ndn-cxx  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/logo-adjustments.css" type="text/css" />
    <link rel="shortcut icon" href="_static/ndn-plain.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Building a Multiple Producer Application" href="ex2.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> ndn-cxx
            <img src="_static/ndn-plain.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examples.html#introductory-example">Introductory Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#complex-example">Complex Example</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="examples.html#table-of-contents">Table Of Contents</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building an Introductory/Trivial application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#consumer">Consumer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#producer">Producer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security-configuration">Security configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application">Running the Application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ex2.html">Building a Multiple Producer Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ndn-cxx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="examples.html">Examples</a> &raquo;</li>
      <li>Building an Introductory/Trivial application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ex1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-an-introductory-trivial-application">
<h1>Building an Introductory/Trivial application<a class="headerlink" href="#building-an-introductory-trivial-application" title="Permalink to this heading"></a></h1>
<section id="consumer">
<h2>Consumer<a class="headerlink" href="#consumer" title="Permalink to this heading"></a></h2>
<p>First, we will create our consumer. A consumer sends out Interests requesting data and will later validate the retrieved data.
The implementation of a consumer utilizes the <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/d9/d55/classndn_1_1Face.html">ndn-cxx:Face</a> class with the default transport (<a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/de/df0/classndn_1_1UnixTransport.html">ndn-cxx:UnixTransport</a>).
The <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/d9/d55/classndn_1_1Face.html">ndn-cxx:Face</a> class essentially provides an interface to the given transport, or if none is given, the default transport which uses the Unix stream socket (<a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/de/df0/classndn_1_1UnixTransport.html">ndn-cxx:UnixTransport</a>). The consumer implementation also uses <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/d9/df9/classndn_1_1security_1_1ValidatorConfig.html#details">ndn-cxx:ValidatorConfig</a> class which is a helper for validating retrieved data.</p>
<p>The following is the basic structure of a consumer, which includes a run function that sends an Interest as well as three callbacks to be called when Data/Nack is retrieved or the consumer’s Interest times out. We also provided a short main function at the end that runs the consumer.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cx/face.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/validator-config.hpp&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="n">namespace</span><span class="w"> </span><span class="n">ndn</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">namespace</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="n">class</span><span class="w"> </span><span class="n">Consumer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">public</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">onData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">onNack</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">lp</span><span class="o">::</span><span class="n">Nack</span><span class="o">&amp;</span><span class="w"> </span><span class="n">nack</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">onTimeout</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Face</span><span class="w"> </span><span class="n">m_face</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ValidatorConfig</span><span class="w"> </span><span class="n">m_validator</span><span class="p">{</span><span class="n">m_face</span><span class="p">};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// end namespace examples</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// end namespace ndn</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ndn</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">Consumer</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>With this skeleton code, we will walk through the implementation of each of these functions, starting with the Consumer constructor. In the constructor, we need to provide the validator with the trust schema that our consumer will use to validate the retrieved data. We hard-coded this trust schema ahead of time, but for more details on how this was done, you can see <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/tutorials/security-validator-config.html">this</a> page.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">m_validator</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;examples/trust-schema.conf&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next, our run function. First, we need to define the Interest name with the <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/da/d3e/classndn_1_1Name.html#details">Name class</a>, which indicates what Data we want to receive. In this example, we will be sending an Interest for /example/testApp/randomData.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="w"> </span><span class="nf">interestName</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next, we want to append a version component to the Interest Name to request new data each time we run. We can either provide the version number or nullopt. If nullopt, then the current UNIX time in milliseconds is appended. In our example, we don’t provide a version number, so UNIX time is used.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">interestName</span><span class="p">.</span><span class="n">appendVersion</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Now that we have the Interest Name, we can create our Interest using the <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/d1/d81/classndn_1_1Interest.html">Interest class</a>. We will enforce that the Interest can only be satisfied with fresh data (not stale data) and that the lifetime of an Interest is 6 seconds. Note that the default lifetime of an Interest is 4 seconds.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Interest</span><span class="w"> </span><span class="nf">interest</span><span class="p">(</span><span class="n">interestName</span><span class="p">);</span><span class="w"></span>
<span class="n">interest</span><span class="p">.</span><span class="n">setMustBeFresh</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="n">interest</span><span class="p">.</span><span class="n">setInterestLifetime</span><span class="p">(</span><span class="mi">6</span><span class="n">_s</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Finally, we can send the Interest with the expressInterest function. Then the processEvents function will block until the requested data is received or a timeout occurs.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sending Interest &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="n">m_face</span><span class="p">.</span><span class="n">expressInterest</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onData</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onNack</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onTimeout</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">));</span><span class="w"></span>

<span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>We have completed the implementation of the run function. Your run function should look like this now.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Name</span><span class="w"> </span><span class="n">interestName</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">interestName</span><span class="p">.</span><span class="n">appendVersion</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">Interest</span><span class="w"> </span><span class="n">interest</span><span class="p">(</span><span class="n">interestName</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">interest</span><span class="p">.</span><span class="n">setMustBeFresh</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">interest</span><span class="p">.</span><span class="n">setInterestLifetime</span><span class="p">(</span><span class="mi">6</span><span class="n">_s</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sending Interest &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">expressInterest</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onData</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onNack</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onTimeout</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next, we will implement the three callback functions, onData, onNack, and onTimeout. All three callback functions have very similar implementations, but onData has an extra step where the consumer needs to verify the received data. To validate the data, we can just use our validator, then we can output it if successful. The following is what the three callback functions look like.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">onData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Received Data &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>


<span class="w">    </span><span class="n">m_validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Data conforms to trust schema&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;The received data: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">getContent</span><span class="p">().</span><span class="n">value</span><span class="p">()),</span><span class="w"></span>
<span class="w">                                        </span><span class="n">d</span><span class="p">.</span><span class="n">getContent</span><span class="p">().</span><span class="n">value_size</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                        </span><span class="p">},</span><span class="w"></span>
<span class="w">                        </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">security</span><span class="o">::</span><span class="n">ValidationError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error authenticating data: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                        </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="kt">void</span><span class="w"> </span><span class="nf">onNack</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">lp</span><span class="o">::</span><span class="n">Nack</span><span class="o">&amp;</span><span class="w"> </span><span class="n">nack</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Received Nack with reason &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">nack</span><span class="p">.</span><span class="n">getReason</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">onTimeout</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Timeout for &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>This completes the consumer implementation. This is what your consumer file should look like.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/face.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/validator-config.hpp&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="c1">// Enclosing code in ndn simplifies coding (can also use `using namespace ndn`)</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">ndn</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// Additional nested namespaces should be used to prevent/limit name conflicts</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="n">class</span><span class="w"> </span><span class="n">Consumer</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">public</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">Consumer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">m_validator</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;examples/trust-schema.conf&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">run</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="nf">interestName</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">interestName</span><span class="p">.</span><span class="n">appendVersion</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="n">Interest</span><span class="w"> </span><span class="nf">interest</span><span class="p">(</span><span class="n">interestName</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">interest</span><span class="p">.</span><span class="n">setMustBeFresh</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">interest</span><span class="p">.</span><span class="n">setInterestLifetime</span><span class="p">(</span><span class="mi">6</span><span class="n">_s</span><span class="p">);</span><span class="w"> </span><span class="c1">// The default is 4 seconds</span>

<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sending Interest &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">expressInterest</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onData</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w">  </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onNack</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Consumer</span><span class="o">::</span><span class="n">onTimeout</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">onData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Received Data &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>


<span class="w">        </span><span class="n">m_validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Data conforms to trust schema&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;The received data: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">getContent</span><span class="p">().</span><span class="n">value</span><span class="p">()),</span><span class="w"></span>
<span class="w">                                            </span><span class="n">d</span><span class="p">.</span><span class="n">getContent</span><span class="p">().</span><span class="n">value_size</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                            </span><span class="p">},</span><span class="w"></span>
<span class="w">                            </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Data</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">security</span><span class="o">::</span><span class="n">ValidationError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error authenticating data: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">                            </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">onNack</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">lp</span><span class="o">::</span><span class="n">Nack</span><span class="o">&amp;</span><span class="w"> </span><span class="n">nack</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Received Nack with reason &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">nack</span><span class="p">.</span><span class="n">getReason</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">onTimeout</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Timeout for &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">Face</span><span class="w"> </span><span class="n">m_face</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ValidatorConfig</span><span class="w"> </span><span class="n">m_validator</span><span class="p">{</span><span class="n">m_face</span><span class="p">};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace examples</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace ndn</span>

<span class="kt">int</span><span class="w"></span>
<span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ndn</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">Consumer</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="producer">
<h2>Producer<a class="headerlink" href="#producer" title="Permalink to this heading"></a></h2>
<p>Now, we will create our producer, which is a little more complicated than our consumer. A producer creates the packets that consumers request with their interests. For our particular producer, we produce packets for Interests with the prefix /example/testApp/randomData.</p>
<p>In our example, after the producer receives an Interest, the producer creates a Data packet with the same name as the received Interest, adds content, and signs it with the /example/testApp identity. It is also possible to specify a particular key to be used during the signing with the <a class="reference external" href="https://named-data.net/doc/ndn-cxx/current/doxygen/de/d59/classndn_1_1security_1_1v2_1_1KeyChain.html">ndn-cxx:KeyChain class</a>, or to simply choose the system default identity.</p>
<p>After the Data packet has been created and signed, it is returned to the requester.</p>
<p>The following is the basic structure of the producer with a run function as well as two callback functions to be called when an Interest with the target prefix is received and when we fail to register the prefix with the NDN forwarder. We also provided a short main function that runs the producer.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/face.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/key-chain.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/signing-helpers.hpp&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="n">namespace</span><span class="w"> </span><span class="n">ndn</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">namespace</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="n">class</span><span class="w"> </span><span class="n">Producer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">public</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">onInterest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InterestFilter</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">onRegisterFailed</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Face</span><span class="w"> </span><span class="n">m_face</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">KeyChain</span><span class="w"> </span><span class="n">m_keyChain</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ScopedRegisteredPrefixHandle</span><span class="w"> </span><span class="n">m_certServeHandle</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ndn</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">Producer</span><span class="w"> </span><span class="n">producer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Starting with the run function, we are going to first set the Interest filter that filters out Interests that this producer can create so that we only respond to the Interest with the specific prefix /example/testApp/randomData.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onInterest</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                    </span><span class="n">nullptr</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next, we also need to filter out Interests with the required certificate that validates this data, in case a consumer requests the certificate. Then the processEvents function will block indefinitely and handle any incoming interests.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_keyChain</span><span class="p">.</span><span class="n">getPib</span><span class="p">().</span><span class="n">getDefaultIdentity</span><span class="p">().</span><span class="n">getDefaultKey</span><span class="p">().</span><span class="n">getDefaultCertificate</span><span class="p">();</span><span class="w"></span>
<span class="n">m_certServeHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="n">security</span><span class="o">::</span><span class="n">extractIdentityFromCertName</span><span class="p">(</span><span class="n">cert</span><span class="p">.</span><span class="n">getName</span><span class="p">()),</span><span class="w"></span>
<span class="w">                          </span><span class="p">[</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="p">...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">cert</span><span class="p">);</span><span class="w"></span>
<span class="w">                          </span><span class="p">},</span><span class="w"></span>
<span class="w">                          </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>

<span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>This completes the run function, which should now look like the following.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onInterest</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">nullptr</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_keyChain</span><span class="p">.</span><span class="n">getPib</span><span class="p">().</span><span class="n">getIdentity</span><span class="p">(</span><span class="s">&quot;/example/testApp&quot;</span><span class="p">).</span><span class="n">getDefaultKey</span><span class="p">().</span><span class="n">getDefaultCertificate</span><span class="p">();</span><span class="w"></span>
<span class="n">m_certServeHandle</span><span class="w"> </span><span class="o">=</span><span class="w">          </span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="n">security</span><span class="o">::</span><span class="n">extractIdentityFromCertName</span><span class="p">(</span><span class="n">cert</span><span class="p">.</span><span class="n">getName</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="p">...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">cert</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next, we will implement the call back functions, starting with onInterest. When our producer receives an Interest with the correct prefix, we will first create the Data packet with the string “Hello World” and a freshness period of 10 seconds.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&gt;&gt; I: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">content</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="n">interest</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span><span class="w"></span>
<span class="n">data</span><span class="o">-&gt;</span><span class="n">setFreshnessPeriod</span><span class="p">(</span><span class="mi">10</span><span class="n">_s</span><span class="p">);</span><span class="w"></span>
<span class="n">data</span><span class="o">-&gt;</span><span class="n">setContent</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Next we will sign the Data packet with the identity “/example/testApp”.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">m_keyChain</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">signingByIdentity</span><span class="p">(</span><span class="s">&quot;/example/testApp&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Finally, we will return the Data packet to the interface we received the interest from.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&lt;&lt; D: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>This completed the onInterest callback which should now look like the following.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">onInterest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InterestFilter</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&gt;&gt; I: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="n">interest</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">setFreshnessPeriod</span><span class="p">(</span><span class="mi">10</span><span class="n">_s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">setContent</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>

<span class="n">m_keyChain</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&lt;&lt; D: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>The onRegisterFailed callback is very simple. In the event that it fails to register the prefix with the NDN forwarder, we will print an error and shut down all pending operations and close the connection to the NDN forwarder.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">onRegisterFailed</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Failed to register prefix &#39;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&#39;with the local forwarder (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">m_face</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>Now we have completed the producer implementation. Your producer should look like the following.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/face.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/key-chain.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ndn-cxx/security/signing-helpers.hpp&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="c1">// Enclosing code in ndn simplifies coding (can also use `using namespace ndn`)</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">ndn</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// Additional nested namespaces should be used to prevent/limit name conflicts</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="n">class</span><span class="w"> </span><span class="n">Producer</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">public</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">run</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="s">&quot;/example/testApp/randomData&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onInterest</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span><span class="w"></span>
<span class="w">                                </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// RegisterPrefixSuccessCallback is optional</span>
<span class="w">                                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_keyChain</span><span class="p">.</span><span class="n">getPib</span><span class="p">().</span><span class="n">getIdentity</span><span class="p">(</span><span class="s">&quot;/example/testApp&quot;</span><span class="p">).</span><span class="n">getDefaultKey</span><span class="p">().</span><span class="n">getDefaultCertificate</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="n">m_certServeHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_face</span><span class="p">.</span><span class="n">setInterestFilter</span><span class="p">(</span><span class="n">security</span><span class="o">::</span><span class="n">extractIdentityFromCertName</span><span class="p">(</span><span class="n">cert</span><span class="p">.</span><span class="n">getName</span><span class="p">()),</span><span class="w"></span>
<span class="w">                                </span><span class="p">[</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="p">...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                </span><span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">cert</span><span class="p">);</span><span class="w"></span>
<span class="w">                                </span><span class="p">},</span><span class="w"></span>
<span class="w">                                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Producer</span><span class="o">::</span><span class="n">onRegisterFailed</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">processEvents</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">onInterest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InterestFilter</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Interest</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interest</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&gt;&gt; I: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">interest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">content</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Create Data packet</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="n">interest</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">setFreshnessPeriod</span><span class="p">(</span><span class="mi">10</span><span class="n">_s</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">setContent</span><span class="p">(</span><span class="n">make_span</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span><span class="w"></span>

<span class="w">        </span><span class="n">m_keyChain</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">signingByIdentity</span><span class="p">(</span><span class="s">&quot;/example/testApp&quot;</span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Return Data packet to the requester</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&lt;&lt; D: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"></span>
<span class="w">    </span><span class="n">onRegisterFailed</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: Failed to register prefix &#39;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">prefix</span><span class="w"></span>
<span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&#39; with the local forwarder (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">m_face</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="n">private</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">Face</span><span class="w"> </span><span class="n">m_face</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">KeyChain</span><span class="w"> </span><span class="n">m_keyChain</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ScopedRegisteredPrefixHandle</span><span class="w"> </span><span class="n">m_certServeHandle</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace examples</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace ndn</span>

<span class="kt">int</span><span class="w"></span>
<span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ndn</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">Producer</span><span class="w"> </span><span class="n">producer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ERROR: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="security-configuration">
<h2>Security configuration<a class="headerlink" href="#security-configuration" title="Permalink to this heading"></a></h2>
<p>In order for the consumer example app to be able to properly authenticate data packets created by the producer app, you must configure the following parameters.</p>
<p>The following commands generate an example trust anchor:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ndnsec key-gen /example
ndnsec cert-dump -i /example &gt; /examples/example-trust-anchor.cert
</pre></div>
</div>
</div></blockquote>
<p>Apps inside the trust zone need keys, certificate and trust policies to secure data communication. /example/testApp needs a key, and the key needs to be certified by /example. Create a key for the producer and sign it with the example trust anchor.</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ndnsec key-gen /example/testApp
ndnsec sign-req /example/testApp <span class="p">|</span> ndnsec cert-gen -s /example -i example <span class="p">|</span> ndnsec cert-install -
</pre></div>
</div>
</div></blockquote>
<p>The command line above makes sure that the example app is under a trust zone, which is established through a trust anchor. The apps inside the trust zone share the generated trust anchor example-trust-anchor.cert.</p>
</section>
<section id="running-the-application">
<h2>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this heading"></a></h2>
<p>First, you must make sure that you have built ndn-cxx with examples:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./waf configure --with-examples
./waf
sudo ./waf install
</pre></div>
</div>
</div></blockquote>
<p>If you encounter build errors, you need only run ./waf again after fixing the errors.</p>
<p>We must start NFD before continuing:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>nfd-start
</pre></div>
</div>
</div></blockquote>
<p>Now, in one terminal run:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./build/examples/producer
</pre></div>
</div>
</div></blockquote>
<p>In a different terminal, run:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./build/examples/consumer
</pre></div>
</div>
</div></blockquote>
<p>You should see appropriate output for both the consumer and the producer.
When you are done, you can terminate NFD with:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>nfd-stop
</pre></div>
</div>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ex2.html" class="btn btn-neutral float-right" title="Building a Multiple Producer Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright ndn-cxx contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>